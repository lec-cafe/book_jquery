# jQuery を利用した読み込み・スクロールの管理

## サイト読み込み時に処理をする

サイトに Loading の標示を設けたりするなどで、
サイト読み込み時になにかの処理を行いたいケースも有るでしょう。

サイト読み込み時と言っても、いくつかのケースが考えられます。
JavaScript で一般的に用意されている「サイト読み込み時」に関わるイベントは以下の ２つのイベントです。

- ブラウザが全ての HTML を認識した時
- ブラウザが全ての必要なリソースをロードし終えた時

### ブラウザが全ての HTML を認識した時

前章の 「jQuery の始め方」でも 紹介したように 
`$(function(){ ... })` の内部に記述した内容は、ブラウザが全ての HTML を認識した後に実行されます。

これにより、JavaScript を読み込むタイミングにかかわらず、
`$(function(){ ... })` の内部に記述した内容は、全てのHTMLコンテンツが解釈されたあとで実行されます。

`$(function(){ ... })` は `$(document).ready(function(){ ... })`の形で紹介されることもあります。


```js
// 下の２つは同じ
$(function(){ 
    // ...
})

$(document).ready(function(){
    // ...
})
```

### ブラウザが全ての必要なリソースをロードし終えた時

Webブラウザは、HTML の解釈を終えた後で、追加で必要となる 
画像やCSS の読み込みを行います。

この追加リソースの読み込みを終えたタイミングでなにか処理を行いたい場合、
`$(window).on('load', function(){ ... })` の形でイベントを記述することができます。

この `$(window).on('load', function(){ ... })` は 
`$(function(){ ... })` の中でも外でも有効に動作しますが、
`$(function(){ ... })` の内部に全ての jQuery 処理を記述する…というルールを徹底する場合は、
`$(function(){ ... })` の内部に記述するほうが良いでしょう。

```js
// どちらの記述でもOK
$(function(){ 
    $(window).on('load', function () {
        // ...
    })
})

$(window).on('load', function () {
    // ...
})
```

### 読み込みから数秒後に処理を実行する

読み込み後、すぐに処理を実行するのではなく、
数秒立ってから処理を実行する場合には JavaScript の `setTimeout` 関数が利用可能です。


```js
// どちらの記述でもOK
$(function(){ 
    setTimeout(function(){
        console.log("２秒後に表示されます。")
    },2000)
})
```

setTimeout は第一引数に `function(){ ... }` の形式で処理を記述し、
第二引数にその処理を何秒後に実行するかをミリ秒単位で指定できます。

1秒 は 1000ミリ秒となっているので、例えば ２秒後に処理を実行する場合は `2000` で指定します。 

また `setInterval`関数は繰り返しのループ処理を定義します。

```js
// どちらの記述でもOK
$(function(){ 
    setInterval(function(){
        console.log("２秒毎に表示されます。")
    },2000)
})
```

## Try!

### お問い合わせアラートの表示

サイトを開いてから数秒後に表示れされるお問い合わせのアラートモーダルの標示を実装してみましょう。

**要件**

- 画面を開いて数秒後に お問い合わせのモーダルが標示される。

https://codepen.io/mikakane/pen/gBVzWj

## スクロールの監視

サイト読み込みとは別に、 jQuery を使ってスクロールの制御をすることもできます。

画面のスクロールに反応する jQuery イベントを記述する場合には以下のようにコードを記述します。

```js
$(window).on("scroll",function() {
    console.log($(this).scrollTop()); 
})
```

`$(this).scrollTop()` で スクロール位置が取得出来るので、
これを利用して、xx ピクセルスクロールしたら…といった処理が可能です。

```js
$(window).on("scroll",function() {
    if($(this).scrollTop() > 50){
        // 50 ピクセル より下にスクロールした時
    }else{
        // 50 ピクセル より上にスクロールした時        
    }
})
```

## スクロールの制御

スクロールを監視する他に、スクロールを制御することも可能です。

以下はよくあるトップに戻るボタンの実装コードです。

```js
$(function(){
  $('.btn-top').on("click",function(){
    $("html, body").animate({scrollTop: 0}, 500);
    return false;
  });
});
```

`$("html, body").animate({scrollTop: 0}, 500)` のコードで、
ゆるりと トップにスクロールする処理が実現できます。

`500` は 500 ミリ秒かけて、を意味するので、
この値を調節して、アニメーションのスピードを調整することができます。


トップではなく任意の要素の位置までスクロールを行う場合は、
ターゲット要素の位置情報を取得する必要があります。

例えば以下のようなコードで `.contact-area` までスクロールする処理を実行することができます。

```js
$(function(){
  $('.btn-contact').on("click",function(){
    var position = $(".contact-area").offset().top;
    $("html, body").animate({scrollTop:position}, 500);
    return false;
  });
});
```

`$(".contact-area").offset().top` は `.contact-area`
のトップのスクロール位置を取得する記法です。

このようにしてターゲット要素のスクロール位置を取得して animate にわたすことで、
任意の要素までのスクロールを実現する事ができます。

## Try!

### トップに戻るボタンの実装

トップに戻るボタンの実装に挑戦してみましょう。

**要件**

- ボタンを押すとサイトトップまでスクロールする。
- サイトトップにいるときは、トップに戻るボタンが非表示になる。
- スクロールすると、トップに戻るボタンが現れる。

### 追跡ナビゲーションの実装

スクロールに追従して変化するナビゲーションの実装に挑戦してみましょう。

**要件**

− ナビゲーションが複数並んで表示される
- 現在表示されているコンテンツに `active`　の表示がなされる
- スクロールに応じて `active` の表示が 現在表示されているコンテンツに応じて変化する
