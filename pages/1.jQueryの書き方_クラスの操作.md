# jQuery でクラスを操作する

## jQuery の書き方

jQuery はWeb上で様々な動作や処理を行うための便利なライブラリです。
現在でも幅広いWebサイトで jQuery　が利用されており、
Vue.js や React などの JS フレームワークと比較しても 導入が簡単で
既存の HTML で書かれた Webサイトへも簡単に適用できる、といったメリットがあります。
 
jQuery は、JavaScript と呼ばれるブラウザ上で動作するプログラミング言語のライブラリとなっており、
jQueryを使ってなにかを記述する際にも この JavaScript の書き方に沿って進めていきます。

HTML 内で JavaScript を利用する場合、 `script` 要素を利用して記述します。

以下の script 要素を HTMLの Body 内の一番下に記述してみましょう。
コンソールに `hello world` が表示されるはずです。

```html
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script >
    $(function(){
        // ここに処理を記述していく
        console.log("hello world")
    })
</script>
```

jQuery を使用する場合、通常 script 要素が最低 2つは必要になります。

一つは、 jQuery 本体を読み込むための script 要素で、
もう一つは jQuery を使ってサイトを操作する際の処理を記述する script 要素です。

上記の例の様に jQuery 本体の読み込みは CDN と呼ばれる 外部に配置された jQuery のソースを利用する事もできますし、
自分で手元にもってきた jQuery を利用する事もできます。
ローカルに jQuery をダウンロードして サイト上で利用する場合、 利用しているjQuery のバージョンがわからなくならないよう注意しましょう。

2つ目のサイトを操作する際の処理を記述する script については、
上記の例のように script 要素で囲った内部に記述する（インライン）こともできますし、
別途 `app.js` のようなスクリプトファイルを作成して src 属性で読み込ませることも可能です。

## jQuery を使ったサイトの処理

jQuery では `$` を利用して、Webサイトに対する様々な処理を記述することができます。

この `$` は jQuery 関数と呼ばれるもので、 `$` から様々な処理を呼び出すことが可能です。

```js
$(function(){
    //...
})
```

通常多くの場面で目にするこの基本の形は `$()` の内部に 関数 `function(){}` を割り当てたものです。

この書き方は、`function(){}` 内部の処理の実行を「ブラウザが全てのHTML要素を認識し終えた後」まで待機させるために必要なものです。

jQuery での多くの記述は、 HTML の要素を利用して行われるため、 HTMLをブラウザがまだ認識していない状態では、
処理をうまく行うことができません。このため、jQuery では 

```js
$(function(){
    //...
})
```
 
の内部に処理を記述していくことが推奨されています。

## jQuery でクリックイベントを処理する

jQueryで行われる主な処理は、ブラウザに対し「要素をクリックした時」「スクロールした時」など
任意のタイミングで特定の動作をさせるよう予約するものです。

「要素をクリックした時」「スクロールした時」のような 任意のタイミングのことを JavaScript では、
**イベント** と呼び、イベントを処理することを **イベントハンドリング** と呼びます。

まずは一番一般的な `click` イベントの扱いについて、確認していきましょう。

HTML 上に サンプルで 以下のような要素を 設置します。

```html
<a class="btn">BUTTON</a>
```

ここで、a 要素には href 属性を設定しないでください(クリックした際に画面遷移してしまうため)。

次に以下のような jQuery の記述を script 要素に追加して、設置したボタンをクリックしてみましょう。 

```js
$(function(){
    $(".btn").on("click",function(){
        console.log("ボタンが押されました")
    })
})
```

コンソールに `ボタンが押されました` と表示されれば成功です。

順番にコードの内容を確認していきましょう。

`$(".btn")` は jQuery でセレクタと呼ばれるものです。 CSS で使用するようなセレクタ構文を使いながら、
HTML 上の要素を指定する事ができます。ここでは HTML 上に配置した a要素を クラス名で指定しています。

`$(".btn").on("click",function(){ ... })`では指定した a要素に対してイベントを設定しています。
この `on` は jQuery でイベントを設定する際に 使われる一般的な構文です。

`()` 内の `,` で区切られたそれぞれのセクションは、引数と呼ばれるもので、順番に第一引数、第二引数と呼ばれます。

第一引数の `click` はイベント名を示し、ここでは「クリックした際」の処理が指定されるようになっています。

第二引数では、実際にイベントが起こった際（クリックされれた際）の処理を記述します。
ここでは`console.log`を記述しているため、イベントが起こった際にコンソールに文字が表示されます。

## jQuery でクラスを操作する

コンソールに文字を表示するだけではつまらないので、次はクラスの操作に挑戦してみましょう。

次のような HTML と JavaScript を用意してボタンをクリックしてみてください。

```html
<p class="message">this is message</p>

<a class="btn">BUTTON</a>
```

```js
$(function(){
    $(".btn").on("click",function(){
        $(".message").addClass("red")
    })
})
```

画面上は何も起こっていない様に見えますが、 
検証ツールで確認してみると、 `.message` のHTML要素に `red` のクラスが追加されているはずです。

`addClass` はjQuery で指定した要素に クラスを付与する関数です。すでにそのクラスが付与されている場合、特に何も起こりません。

クラスを変化させるだけでは、見た目の変化は何も起こりませんが、
例えば以下のようなCSS を追加することで、ボタンを押すと文字が赤く変化する、といった動作を実現することができます。

```css
.red{
    color: red
}
```

jQuery を使ってWebサイト上の処理を記述する場合、このようにクラスの変化を jQuery 上で実現し、
クラスの変化に反応する CSS と連携させることで画面上の動きを実現する、とった手法がとられるケースがほとんどです。

単に文字を赤くする場合 `css`関数を使って

```js
$(function(){
    $(".btn").on("click",function(){
        $(".message").css("color","red")
    })
})
```

のようにすることもできますが、これではスタイルの記述が JS と CSS 内で混在してしまい、管理するのが困難になります。
可能な限り、デザインは CSS で表現し jQuery ではクラスを変化させるだけ、に留めるほうが良いでしょう。

### jQuery における 様々なクラスの操作

`addClass`　とは対象的に `removeClass` は付与されているクラスを削除します。

以下のように `red` クラスを付与するボタン、削除するボタンを作ることで、
文字の色をパタパタと変化させることが可能です。

```html
<p class="message">this is message</p>

<a class="btn-red">RED</a>
<a class="btn-default">BLACK</a>
```

```js
$(function(){
    $(".btn-red").on("click",function(){
        $(".message").addClass("red")
    })
    $(".btn-default").on("click",function(){
        $(".message").removeClass("red")
    })
})
```

`hasClass`　は クラスが付与されているかを確認します。
JavaScript の If 文と組み合わせて条件分岐の処理を追加することができます。

以下の様に `hasClass` と `addClass` `removeClass` を組み合わせて、
一つのボタンでパタパタと文字色を変更させることも可能です。

```html
<p class="message">this is message</p>

<a class="btn">TOGGLE</a>
```

```js
$(function(){
    $(".btn").on("click",function(){
        if($(".message").hasClass("red")){
            $(".message").removeClass("red")            
        }else{
            $(".message").addClass("red")                        
        }
    })
})
```

`if ... else ... ` 文は JavaScript の条件分岐の構文で、`{ }` で囲まれた2つのブロックから構成されます。

`if()` の `()` 内の処理が true となれば　最初の `{}` ブロックが、
false となれば 2番めの `{}` ブロックが処理されます。

`if($(".message").hasClass("red"))` の場合、 `.message` に `.red` クラスが付与されていれば true 
付与されていなければ false となります。

このように、一つのボタンが 現在の状態に応じて ON/OFF を切り替えて処理することを トグル(toggle) といいますが、
トグルの処理を実行する際には `toggleClass` 関数を利用することも可能です。

```html
<p class="message">this is message</p>

<a class="btn">TOGGLE</a>
```

```js
$(function(){
    $(".btn").on("click",function(){
        $(".message").toggleClass("red")            
    })
})
```

### クリックされた要素の判別

`$(".btn").on("click",function(){....})` によるイベントの登録は、
`.btn` に該当する全ての要素に対して適用されます。

イベント内で、どの要素が押されたのかを取得する際には、 `this` を利用します。

```html
<a class="btn">BTN1</a>
<a class="btn">BTN2</a>
<a class="btn">BTN3</a>
```

```js
$(function(){
    $(".btn").on("click",function(){
        $(this).addClass("red")            
    })
})
```

このようにすることで、押されたボタンにのみ `red` クラスが付与されます。

応用として クリックされた要素からオプション値を取得することも可能です。

以下の例では、クリックされた要素ごとに、 `red` `big` `underline` の異なるクラスが付与されます。

```html
<p class="message">this is message</p>

<a class="btn" data-style="red">red</a>
<a class="btn" data-style="big">big</a>
<a class="btn" data-style="underline">underline</a>
```

```js
$(function(){
    $(".btn").on("click",function(){
        var style = $(this).attr("data-style")
        $(".message").addClass(style)            
    })
})
```

`attr` は指定した要素の属性を取得する関数です。
ここでは `$(this).attr("data-style")` としているため、クリックされた要素の `data-style` 属性を取得しています。

取得した属性は、 `style` という名前の 変数に格納されています。
JavaScript では `var` と呼ばれる記述を用いて、値を変数に格納することが可能です。
変数への値の代入は `=` で行います。

最後に取得した変数を用いて、`.message` にクラスを付与しています。 

## Try!

### モーダルの作成

ボタンをクリックして表示されるモーダルの実装を jQuery で行ってみましょう。

**要件**

- ボタンをクリックすると画面上にモーダルが表示される
- モーダル上のボタンをクリックすると、モーダルが非表示になる

**HINT**

- 表示されるモーダルは `display:none` で定義しておき、ボタンクリック後に `active` クラスを付与して `display:block` のCSS が適用されるようにします。
- モーダル上の閉じるボタンには `active` クラスを削除する処理を指定します。

### ドロップダウンメニューの作成

ボタンをクリックして表示されるメニューの実装を jQuery で行ってみましょう。

**要件**

- ボタンをクリックするとボタンの側にメニューが表示される
- メニュー上の閉じるボタンをクリックして、メニューがクローズされる。

**HINT**

- モーダルとほぼ同じ処理で実装可能なはずです。

### タブの作成

タブ形式で表示を切り替えるナビゲーションの作成を行ってみましょう。

**要件**

- 画面上に 3つ程度のタブを並べる
- タブをクリックスすると表示領域の内容が切り替わる。
- 現在選択されているタブは、他のタブとは異なる active の表示がなされる。

**HINT**

- タブごとに、それぞれ異なるパネルの表示切り分けが出来るよう処理の調整が必要です。
- 現在のタブを表示する上で、１つだけが `active` となるよう セレクタの使い方を工夫してみてください。

## AND MORE ... 

### 様々なイベント 

`on` では　`click` の他にも様々なイベントが利用可能です。

クリック関係では、`dblclick` イベントが利用可能です。

- click	クリックされた際
- dblclick	ダブルクリックされた際

要素のフォーカス関連で以下のようなイベントも用意されています。

- blur	要素がフォーカスを失った際に発生
- focus	要素がフォーカスを得た際に発生

カーソルの動きに関連する以下のようなイベントで :hover 関連の処理も実装可能です。

- mousemove	要素上でカーソルが移動している際に発生
- mouseenter	カーソルが要素に入った際に発生。
- mouseleave	カーソルが要素から外れた際に発生。

フォームに関連して以下のようなイベントも用意されています。

- change	要素がフォーカスを得て値の修正が完了した際に発生
- submit	フォームが送信された際に発生
- keydown	キーが押し下げられた際に発生
- keypress	キーが押された際に発生
- keyup	キーが上がった際に発生

また、要素ではなく画面全体に対して適用されるイベントもあります。

- load	ドキュメント内の全リソースの読み込みが完了したときに発生
- resize	windowの大きさが変更された際に発生
- scroll	ドキュメントがスクロールした際に発生

`load`などの画面に対するイベントは, `$(window)` に対してイベントを設定します。

```js
$(function(){
    $(window).on("load",function(){
        //...
    })
})

```
